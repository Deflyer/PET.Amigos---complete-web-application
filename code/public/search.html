<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap related -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.7.2/font/bootstrap-icons.min.css"
        rel="stylesheet">

    <!-- Nossos css -->
    <link rel="stylesheet" href="./style_header_footer.css">
    <link rel="stylesheet" href="./style_pet_page.css">
    <link rel="stylesheet" href="./style_search.css">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <script src="https://kit.fontawesome.com/ced5a00aa9.js" crossorigin="anonymous"></script>


    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <title>Search Page</title>

</head>

<body>
    <main class="container-fluid">
        <div class="row">
            <div class="col d-none lilacBgColor recom">
                <div class="container text-start">
                    <h1 class="py-3 font_h1_search">Opções para você!</h1>
                    <div id="Sugestoes" class="d-flex justify-content-center flex-wrap">

                    </div>
                </div>
            </div>
            <div class="d-block d-md-none pt-2 pb-5 lilacBgColor">
                <div class="container">
                    <h1 class="py-3 font_h1_search">Opções para você!</h1>
                    <div id="Carrossel_buscas" class="carousel slide">
                        <div id="SugestoesMobile" class="carousel-inner rounded-4">
                        
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#Carrossel_buscas"
                            data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#Carrossel_buscas"
                            data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col bg-jesus offcanvas-md offcanvas-start" tabindex="-1" id="offcanvasResponsive"
                aria-labelledby="offcanvasResponsiveLabel" style="max-width: fit-content; min-width: fit-content;">
                <div class="offcanvas-header">
                    <h2 class="offcanvas-title font_prefs" id="offcanvasResponsiveLabel">PREFERÊNCIAS</h2>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"
                        data-bs-target="#offcanvasResponsive" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body overflow-y-auto">
                    <ul class="d-flex flex-column list-unstyled px-4">
                        <p class="d-md-block d-none pt-3 text-center font_prefs">PREFERÊNCIAS</p>
                        <li class="mb-3">
                            <div class="d-flex flex-column text-center">
                                <button
                                    class="shadow btn btn-toggle d-inline-flex align-items-center rounded-pill collapsed"
                                    data-bs-toggle="collapse" data-bs-target="#cidade-filtro" aria-expanded="true">
                                    CIDADE
                                </button>
                                <div class="rounded-4 show" id="cidade-filtro" style="background-color: #E4E4E4;">
                                    <ul class="list-unstyled my-2 mx-4">
                                        <li>
                                            <input type="text" id="cidade-input"
                                                class="form-control text-center rounded-pill"
                                                placeholder="Digite a cidade" style="border-color: #3A0CA3;">
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                        <li class="mb-3">
                            <div class="d-flex flex-column text-center">
                                <button
                                    class="shadow btn btn-toggle d-inline-flex align-items-center rounded-pill collapsed"
                                    data-bs-toggle="collapse" data-bs-target="#estado-filtro" aria-expanded="true">
                                    ESTADO
                                </button>
                                <div class="rounded-4 show" id="estado-filtro" style="background-color: #E4E4E4;">
                                    <ul class="list-unstyled my-2 mx-4">
                                        <li>
                                            <input type="text" id="estado-input"
                                                class="form-control text-center rounded-pill"
                                                placeholder="Digite o estado (Sigla)" style="border-color: #3A0CA3;">
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                        <li class="mb-3">
                            <div class="d-flex flex-column text-center">
                                <button
                                    class="shadow btn btn-toggle d-inline-flex align-items-center rounded-pill collapsed"
                                    data-bs-toggle="collapse" data-bs-target="#especie-filtro" aria-expanded="true">
                                    ESPÉCIE
                                </button>
                                <div class="rounded-4 show" id="especie-filtro" style="background-color: #E4E4E4;">
                                    <ul class="list-unstyled my-3">
                                        <li>
                                            <button class="btn-toggle-item btn btn-outline-purple rounded-pill"
                                                data-key="type" data-value="Cachorro">Cachorro</button>
                                        </li>
                                        <li>
                                            <button class="btn-toggle-item btn btn-outline-purple rounded-pill"
                                                data-key="type" data-value="Gato">Gato</button>
                                        </li>
                                        <li>
                                            <button class="btn-toggle-item btn btn-outline-purple rounded-pill"
                                                data-key="type" data-value="Roedores">Roedores</button>
                                        </li>
                                        <li>
                                            <button class="btn-toggle-item btn btn-outline-purple rounded-pill"
                                                data-key="type" data-value="Outros">Outros</button>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                        <li class="mb-3">
                            <div class="d-flex flex-column text-center">
                                <button
                                    class="shadow btn btn-toggle d-inline-flex align-items-center rounded-pill collapsed"
                                    data-bs-toggle="collapse" data-bs-target="#sexo-filtro" aria-expanded="true">
                                    SEXO
                                </button>
                                <div class="rounded-4 show" id="sexo-filtro" style="background-color: #E4E4E4;">
                                    <ul class="list-unstyled my-3">
                                        <li>
                                            <button class="col-8 btn-toggle-item btn btn-outline-purple rounded-pill"
                                                data-key="sex" data-value="Macho">Macho</button>
                                        </li>
                                        <li>
                                            <button class="col-8 btn-toggle-item btn btn-outline-purple rounded-pill"
                                                data-key="sex" data-value="Fêmea">Fêmea</button>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                        <li class="mb-3">
                            <div class="d-flex flex-column text-center">
                                <button
                                    class="shadow btn btn-toggle d-inline-flex align-items-center rounded-pill collapsed"
                                    data-bs-toggle="collapse" data-bs-target="#temperamento-filtro"
                                    aria-expanded="true">
                                    TEMPERAMENTO
                                </button>
                                <div class="rounded-4 show" id="temperamento-filtro" style="background-color: #E4E4E4;">
                                    <ul class="list-unstyled my-3">
                                        <li>
                                            <button class="col-8 btn-toggle-item btn btn-outline-purple rounded-pill"
                                                data-key="par_temperaments" data-value="Dócil">Dócil</button>
                                        </li>
                                        <li>
                                            <button class="col-8 btn-toggle-item btn btn-outline-purple rounded-pill"
                                                data-key="par_temperaments" data-value="Agitado">Agitado</button>
                                        </li>
                                        <li>
                                            <button class="col-8 btn-toggle-item btn btn-outline-purple rounded-pill"
                                                data-key="par_temperaments" data-value="Brincalhão">Brincalhão</button>
                                        </li>
                                        <li>
                                            <button class="col-8 btn-toggle-item btn btn-outline-purple rounded-pill"
                                                data-key="par_temperaments" data-value="Tímido">Tímido</button>
                                        </li>
                                        <li>
                                            <button class="col-8 btn-toggle-item btn btn-outline-purple rounded-pill"
                                                data-key="par_temperaments" data-value="Calmo">Calmo</button>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                        <li class="mb-3">
                            <div class="d-flex flex-column text-center">
                                <button
                                    class="shadow btn btn-toggle d-inline-flex align-items-center rounded-pill collapsed"
                                    data-bs-toggle="collapse" data-bs-target="#idade-filtro" aria-expanded="true">
                                    IDADE
                                </button>
                                <div class="rounded-4 show" id="idade-filtro" style="background-color: #E4E4E4;">
                                    <ul class="list-unstyled my-3">
                                        <li>
                                            <button class="col-8 btn-toggle-item btn btn-outline-purple rounded-pill"
                                                data-key="birth" data-value="Filhote">Filhote</button>
                                        </li>
                                        <li>
                                            <button class="col-8 btn-toggle-item btn btn-outline-purple rounded-pill"
                                                data-key="birth" data-value="Jovem">Jovem</button>
                                        </li>
                                        <li>
                                            <button class="col-8 btn-toggle-item btn btn-outline-purple rounded-pill"
                                                data-key="birth" data-value="Adulto">Adulto</button>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                        <li class="mb-3">
                            <div class="d-flex flex-column text-center">
                                <button
                                    class="shadow btn btn-toggle d-inline-flex align-items-center rounded-pill collapsed"
                                    data-bs-toggle="collapse" data-bs-target="#outros-filtro" aria-expanded="true">
                                    OUTROS
                                </button>
                                <div class="rounded-4 show" id="outros-filtro" style="background-color: #E4E4E4;">
                                    <ul class="list-unstyled my-3">
                                        <li>
                                            <button class="col-8 btn-toggle-item btn btn-outline-purple rounded-pill"
                                                data-key="castrated" data-value="castrated">Castrado</button>
                                        </li>
                                        <li>
                                            <button class="col-8 btn-toggle-item btn btn-outline-purple rounded-pill"
                                                data-key="chipped" data-value="chipped">Chipado</button>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="col">
                <div class="row">
                    <div class="col">
                        <div class="d-md-none d-flex justify-content-evenly align-items-center mt-4">
                            <div class="d-md-none d-flex flex-column justify-content-evenly align-items-center mt-4">
                                <button class="btn font-btn-filter d-md-none" type="button" data-bs-toggle="offcanvas"
                                    data-bs-target="#offcanvasResponsive" aria-controls="offcanvasResponsive">
                                    <i class="bi bi-filter"></i>
                                    Filtros
                                </button>
                                <button id="SearchButtonMobile"
                                    class="btn btn-search rounded-pill align-items-center">Aplicar Filtros</button>
                            </div>
                        </div>
                        <div id="activeFilters"
                            class="align-items-center d-md-flex d-none flex-wrap text-nowrap mt-5 ms-5">
                            <span class="font-btn-filter me-4">
                                <i class="bi bi-filter"></i>
                                Filtros ativos:
                            </span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <button id="SearchButtonDesktop"
                            class="btn btn-search rounded-pill align-items-center d-md-flex d-none flex-wrap my-4 ms-5">Aplicar
                            Filtros</button>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <div id="PetsEncontrados"
                            class="d-lg-flex d-none mx-5 mt-2 align-items-center justify-content-between">

                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <div class="container text-center">
                            <div id="GridPets" class="d-flex flex-wrap"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="./header.js"></script>
    <script src="./footer.js"></script>
    <script src="./filters.js"></script>
    <script>
        async function RecomendarPets() {
            try {
                const recomendacoes = document.querySelector('.recom')
                let userIdFromToken = 0;

                role = localStorage.getItem('role')
                if (role === "USER") {
                    recomendacoes.classList.add('d-md-block');
                    token = localStorage.getItem('token')
                    if (token) {
                        const parts = token.split('.');
                        if (parts.length === 3) {
                            const parts = token.split('.');
                            const payload = parts[1];
                            const decodedPayload = atob(payload);
                            const attributes = JSON.parse(decodedPayload);
                            userIdFromToken = attributes.sub;
                            const userEmailFromToken = attributes.email;
                        }
                        let pars = {
                            user_id: userIdFromToken
                        }
                        axios.get('http://localhost:3000/pets/recomendations', { params: pars })
                            .then(async (response) => {
                                console.log(response.data);
                                const data = response.data;
                                const animals = Array.isArray(data) ? data : [data];

                                const container = document.getElementById('Sugestoes');
                                const containerMobile = document.getElementById('SugestoesMobile');

                                for (let i = 0; i < animals.length; i++) {
                                    const animal = animals[i];
                                    try {
                                        const source_img = await fetchImage(animal.photos);
                                        let isLiked = true;
                                        const likesResponse = await fetch(`/likes/${userIdFromToken}/${animal.id}`);
                                        const likedPet = await likesResponse.json();
                                        let invisivel = ""
                                        if (likedPet === null) {
                                            isLiked = false;
                                        }
                                        if (userIdFromToken === 0) {
                                            invisivel = "d-none"
                                        }
                                        const coracaoImgSrc = isLiked ? './img/red-heart-svgrepo-com.svg' : './img/empty-heart.svg';
                                        console.log(coracaoImgSrc);

                                        const card = `
                                            <a href="pet.html?id=${animal.id}" style="text-decoration: none">
                                                <div class="card rounded-5 m-3 img-size">
                                                    <img src="${source_img}" class="card-img-top rounded-top-5 border-img-card" alt="${animal.name}">
                                                    <div class="card-body purpleBgColor rounded-bottom-5 border-card">
                                                        <h5 class="card-title font_name_white">${animal.name}</h5>
                                                        <p class="card-text font_infos_white">${animal.city}, ${animal.state}</p>
                                                        <span class="coracao">
                                                            <button id="toggleHeart" type="button" class="btn btn-link p-0 m-0 heart-button ${invisivel}" data-pet-id="${animal.id}">
                                                                <img src="${coracaoImgSrc}" alt="" class="img-fluid">
                                                            </button>
                                                        </span>
                                                    </div>
                                                </div>
                                            </a>
                                        `;

                                        const isActive = i === 0 ? 'active' : '';
                                        const cardMobile = `
                                            <a href="pet.html?id=${animal.id}" style="text-decoration: none">
                                                <div class="carousel-item ${isActive}">
                                                    <div class="d-flex justify-content-center">
                                                        <div class="card rounded-5 m-3 img-size" style="margin: auto;">
                                                            <img src="${source_img}" class="card-img-top rounded-top-5 border-img-card" alt="${animal.name}">
                                                            <div class="card-body purpleBgColor rounded-bottom-5 border-card">
                                                                <h5 class="card-title font_name_white">${animal.name}</h5>
                                                                <p class="card-text font_infos_white">${animal.city}, ${animal.state}</p>
                                                                <span class="coracao">
                                                                    <button id="toggleHeart" type="button" class="btn btn-link p-0 m-0 heart-button ${invisivel}" data-pet-id="${animal.id}">
                                                                        <img src="${coracaoImgSrc}" alt="" class="img-fluid">
                                                                    </button>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>
                                        `;

                                        container.innerHTML += card;
                                        containerMobile.innerHTML += cardMobile;
                                    } catch (error) {
                                        console.error(`Erro ao processar animal com ID ${animal.id}`, error);
                                    }
                                }
                                const coracaoButtons = document.querySelectorAll('.heart-button');
                                
                                coracaoButtons.forEach(coracaoButton => {
                                    if (userIdFromToken !== 0) {
                                        recomendacoes.style.display = 'none'

                                        coracaoButton.addEventListener('click', async (event) => {
                                            event.preventDefault();
                                            event.stopPropagation();

                                            const petId = coracaoButton.dataset.petId;
                                            const coracaoImg = coracaoButton.querySelector('img');
                                            if (coracaoImg.src.includes('red-heart-svgrepo-com')) {
                                                try {
                                                    const response = await fetch(`/likes/${userIdFromToken}/${petId}`, { method: 'DELETE' });
                                                    if (response.ok) {
                                                        console.log(`Curtida removida para o pet com ID ${petId}`);
                                                    } else {
                                                        console.error('Erro ao remover a curtida');
                                                    }
                                                } catch (error) {
                                                    console.error('Erro ao remover a curtida:', error);
                                                }

                                                coracaoImg.src = './img/empty-heart.svg';
                                            } else {
                                                try {
                                                    const response = await fetch(`/likes`, {
                                                        method: 'POST',
                                                        headers: { 'Content-Type': 'application/json' },
                                                        body: JSON.stringify({ UserId: userIdFromToken, petId: petId })
                                                    });
                                                    if (response.ok) {
                                                        console.log(`Curtida adicionada para o pet com ID ${petId}`);
                                                    } else {
                                                        console.error('Erro ao adicionar a curtida');
                                                    }
                                                } catch (error) {
                                                    console.error('Erro ao adicionar a curtida:', error);
                                                }

                                                coracaoImg.src = './img/red-heart-svgrepo-com.svg';
                                            }
                                        });
                                    }
                                });
                            })
                            .catch(error => {
                                console.error(error);
                            });
                    }
                }
            } catch (error) {
                console.error('Erro ao buscar Pets', error);
            }
        }
        document.addEventListener('DOMContentLoaded', RecomendarPets());
    </script>
    <script>
        let pars = {
            birthstart: null,
            birthend: null,
            city: null,
            state: null,
            type: [],
            sex: [],
            par_temperaments: [],
            castrated: null,
            chipped: null,
            adopted: null
        }
        let filhote = false, jovem = false, adulto = false;

        document.querySelectorAll('.btn-toggle-item').forEach(button => {
            button.addEventListener('click', (event) => {
                const key = event.target.getAttribute('data-key');
                const value = event.target.getAttribute('data-value');

                if (key === "birth") {
                    const ano_atual = "2024-01-01";

                    if (value === "Filhote") {
                        if (filhote)
                            filhote = false;
                        else
                            filhote = true;
                    }
                    if (value === "Jovem") {
                        if (jovem)
                            jovem = false;
                        else
                            jovem = true;
                    }
                    if (value === "Adulto") {
                        if (adulto)
                            adulto = false;
                        else
                            adulto = true;
                    }
                    if (adulto)
                        pars.birthstart = "0000-01-01";
                    else if (jovem)
                        pars.birthstart = "2019-01-01";
                    else if (filhote)
                        pars.birthstart = "2023-01-01";
                    else
                        pars.birthstart = null;
                    if (filhote)
                        pars.birthend = ano_atual
                    else if (jovem)
                        pars.birthend = "2023-01-01";
                    else if (adulto)
                        pars.birthend = "2019-01-01";
                    else
                        pars.birthend = null;
                }

                if (key === "type" || key === "sex" || key === "par_temperaments") {
                    if (pars[key] === null) {
                        pars[key] = [];
                    }

                    const index = pars[key].indexOf(value);

                    if (index !== -1) {
                        pars[key].splice(index, 1);
                    } else {
                        pars[key].push(value);
                    }
                    if (pars[key].length === 0) {
                        pars[key] = null;
                    }
                }
                if (key === "castrated" || key === "chipped") {
                    if (pars[key] === true || pars[key] === "true")
                        pars[key] = null;
                    else
                        pars[key] = true;
                }
            });
        });
        async function RefazerBusca() {
            try {
                const cidadeInput = document.getElementById('cidade-input').value.trim();
                const estadoInput = document.getElementById('estado-input').value.trim();
                let userIdFromToken = 0;
                role = localStorage.getItem('role')
                if (role === "USER") {
                    token = localStorage.getItem('token')
                    if (token) {
                        const parts = token.split('.');
                        if (parts.length === 3) {
                            const parts = token.split('.');
                            const payload = parts[1];
                            const decodedPayload = atob(payload);
                            const attributes = JSON.parse(decodedPayload);
                            userIdFromToken = attributes.sub;
                            const userEmailFromToken = attributes.email;
                        }
                    }
                }
                if (cidadeInput && cidadeInput !== "")
                    pars.city = cidadeInput;
                else
                    pars.city = null;
                if (estadoInput && estadoInput !== "")
                    pars.state = estadoInput;
                else
                    pars.state = null;


                if (pars.birthstart === null)
                    pars.birthstart = '0000-00-00';
                if (pars.birthend === null)
                    pars.birthend = '9999-99-99';

                axios.get('http://localhost:3000/pets/search', { params: pars })
                    .then(async (response) => {
                        console.log(response.data);
                        const data = response.data;
                        const animals = Array.isArray(data) ? data : [data];

                        const pets_encontrados = document.getElementById("PetsEncontrados");
                        const container = document.getElementById('GridPets');

                        container.innerHTML = '';
                        pets_encontrados.innerHTML = '';

                        const h2Pets = document.createElement('h2');
                        h2Pets.classList.add('font_h2_search');
                        h2Pets.textContent = `${animals.length} Pets encontrados!`;

                        pets_encontrados.appendChild(h2Pets);
                        for (const animal of animals) {
                            try {
                                const source_img = await fetchImage(animal.photos);
                                let isLiked = true;
                                const likesResponse = await fetch(`/likes/${userIdFromToken}/${animal.id}`);
                                const likedPet = await likesResponse.json();
                                let invisivel = ""
                                if (likedPet === null) {
                                    isLiked = false;
                                }
                                if (userIdFromToken === 0) {
                                    invisivel = "d-none"
                                }
                                const coracaoImgSrc = isLiked ? './img/red-heart-svgrepo-com.svg' : './img/empty-heart.svg';
                                console.log(coracaoImgSrc);
                                const card = `
                                    <a href="pet.html?id=${animal.id}" style="text-decoration: none">
                                        <div class="card rounded-5 m-3 img-size">
                                            <img src="${source_img}" class="card-img-top rounded-top-5 border-img-card" alt="${animal.name}">
                                            <div class="card-body rounded-bottom-5 border-card">
                                                <h5 class="card-title font_name_black">${animal.name}</h5>
                                                <p class="card-text font_infos_black">${animal.city}, ${animal.state}</p>
                                                <span class="coracao">
                                                    <button id="toggleHeart" type="button" class="btn btn-link p-0 m-0 heart-button ${invisivel}" data-pet-id="${animal.id}">
                                                        <img src="${coracaoImgSrc}" alt="" class="img-fluid">
                                                    </button>
                                                </span>
                                            </div>
                                        </div>
                                    </a>
                                    `;
                                container.innerHTML += card;
                            } catch (error) {
                                console.error(`Erro ao processar animal com ID ${animal.id}`, error);
                            }
                        }

                        const coracaoButtons = document.querySelectorAll('.heart-button');
                        coracaoButtons.forEach(coracaoButton => {
                            if (userIdFromToken !== 0) {

                                coracaoButton.addEventListener('click', async (event) => {
                                    event.preventDefault();
                                    event.stopPropagation();

                                    const petId = coracaoButton.dataset.petId;
                                    const coracaoImg = coracaoButton.querySelector('img');
                                    if (coracaoImg.src.includes('red-heart-svgrepo-com')) {
                                        try {
                                            const response = await fetch(`/likes/${userIdFromToken}/${petId}`, { method: 'DELETE' });
                                            if (response.ok) {
                                                console.log(`Curtida removida para o pet com ID ${petId}`);
                                            } else {
                                                console.error('Erro ao remover a curtida');
                                            }
                                        } catch (error) {
                                            console.error('Erro ao remover a curtida:', error);
                                        }

                                        coracaoImg.src = './img/empty-heart.svg';
                                    } else {
                                        try {
                                            const response = await fetch(`/likes`, {
                                                method: 'POST',
                                                headers: { 'Content-Type': 'application/json' },
                                                body: JSON.stringify({ UserId: userIdFromToken, petId: petId })
                                            });
                                            if (response.ok) {
                                                console.log(`Curtida adicionada para o pet com ID ${petId}`);
                                            } else {
                                                console.error('Erro ao adicionar a curtida');
                                            }
                                        } catch (error) {
                                            console.error('Erro ao adicionar a curtida:', error);
                                        }

                                        coracaoImg.src = './img/red-heart-svgrepo-com.svg';
                                    }
                                });
                            }
                        });
                    })
                    .catch(error => {
                        console.error(error);
                    });
            } catch (error) {
                console.error('Erro ao buscar Pets', error);
            }
        }
        document.addEventListener('DOMContentLoaded', RefazerBusca());
        document.getElementById('SearchButtonMobile').addEventListener('click', RefazerBusca);
        document.getElementById('SearchButtonDesktop').addEventListener('click', RefazerBusca);
    </script>
    <script>
        async function fetchImage(url) {
            try {
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    url = 'http://' + url;
                }
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const blob = await response.blob();
                return URL.createObjectURL(blob);
            } catch (error) {
                console.error('There was a problem with the fetch operation:', error);
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        crossorigin="anonymous"></script>

</body>

</html>